# nikodex2-backend
Backend for Nikodex V2 in Python using FastAPI

## Dependecies
To setup the backend server, you'll need:
- Python 3
- MySQL

## Setup for developing
1. (Recommended) Setup a virtual environment for the project
```bash
python -m venv virtual-env

# only run one of the following commands depending on the OS/shell you're using
source virtual-env/bin/activate # Linux ONLY (bash, zsh, ...)
source virtual-env/bin/activate.fish # Linux ONLY (fish)
virtual-env\Scripts\Activate.ps1 # Windows ONLY (powershell)
virtual-env\Scripts\activate.bat # Windows ONLY (cmd)
```
2. Setup a blank MySQL database with the provided `server_schema.sql` file.
3. Setup/upgrade the Nikodex's database by running:
```
alembic upgrade head
```
4. Install all the required dependecies
```bash
pip install -r requirements.txt
pip install "fastapi[standard]" # fastapi command line tool
```
5. Configure the server by creating a .env file with the following content (replace the brackets with actual data):
```
# MySQL server setup.
MYSQL_USER="<mysql_username>"
MYSQL_PASS="<mysql_password>"
MYSQL_URI="<mysql_host_or_url>"
MYSQL_PORT="<mysql_port>"

# you may need to pass in the origin of the front-end server here if it's
# unable to access the back-end. otherwise, leave it BLANK
FASTAPI_ALLOWED_ORIGIN="<allowed_url_1>,<allowed_url_2>,..."

# Secret key: to be generated by running 'openssl rand -hex 32'
SECRET_KEY="<secret key here>"
ALGORITHM="HS256"

# Path to store the image of Nikosona
IMG_DIR=""

API_BOT_SHARED_SECRET="<shared_secret>" # a shared secret between the bot and the backend API for bot-specific API routes. it is recommended that you use a long, random value for this. this value MUST MATCH with the one on nikodex2-bot
```

6. Create an admin account with the provided `_account_manage.py` script
```
python _account_manage.py
```

7. Run the dev server
```
fastapi dev server.py
```

p.s.: If you're planning on using the dev mode for production: **__DON'T__**

## Setup for production
> Follow the same step from 1 to 6 in the [Setup for developing](#setup-for-developing) section
7. Run the production server
```
fastapi run main.py
```
This is the default way to run the backend server, and it should work for most cases.

However, since the backend server is an ASGI app, you can use a different ASGI server program. For instance, you can use gunicorn to run the backend server with options to create more workers
```bash
# FOR UNIX/LINUX ONLY
gunicorn -k uvicorn.workers.UvicornWorker server:app --workers 4 --bind 0.0.0.0:8000
```

## Upgrade
Since this project is in development, you may want to upgrade the package to the latest commit. To do so:
1. Pull the latest commit from GitHub:
```
git pull
```
2. Upgrade the database:
```
alembic upgrade head
```
3. Run the dev/production server (step 7)

## Accounts
As of now, there is only one type of account for Nikodex v2, which is Administrator (or admin for short). These accounts have access to the admin dashboard on the front-end, and can manage data about Nikosonas and Blogs on the database.

If you wish to create more admin accounts to manage the Nikodex, use the `_account_manage.py` scripts to create, edit, or remove admin accounts.